# Inside telegraf.conf

# --------------------------------------------------------------------------
# A. Output Configuration (The PUSH Mechanism)
# --------------------------------------------------------------------------
[[outputs.prometheus_remote_write]]
  ## The URL where Telegraf will PUSH metrics
  url = "https://prometheus-7484ca.onvpn.net/api/v1/write"

  ## Required for HTTPS: If the Prometheus ingress uses a self-signed certificate, 
  ## you may need to set this to 'true'. Consult your cluster admin first.
  # insecure_skip_verify = true 

  [outputs.prometheus_remote_write.tags]
    source_vm = "gpuvm6" 
    app_service = "voice_cloner" 

# --------------------------------------------------------------------------
# B. Input Configuration (The Collectors)
# --------------------------------------------------------------------------

# Docker Container Input - Targets ONLY your running container
[[inputs.docker]]
  endpoint = "unix:///var/run/docker.sock"
  container_names = ["tts-v1-fp16-running"] # Assuming the container name is this
  gather_services = false

# NVIDIA GPU Monitoring - Uses nvidia-smi for low overhead
[[inputs.nvidia_smi]]
  bin_path = "/usr/bin/nvidia-smi"
  metrics_include = [
    "utilization_gpu", 
    "memory_used", 
    "temperature_gpu"
  ]
